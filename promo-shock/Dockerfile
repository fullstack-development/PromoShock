FROM node:20-slim

ARG NEXT_PUBLIC_API_URL
ARG NEXT_PUBLIC_WC_PROJECT_ID
ARG NEXT_PUBLIC_IS_TESTNET
ARG NEXT_PUBLIC_BSC_CHAIN_ID
ARG NEXT_PUBLIC_BSC_RPC_URL
ARG NEXT_PUBLIC_BSC_TICKET_FACTORY_ADDRESS
ARG NEXT_PUBLIC_BSC_PROMO_FACTORY_ADDRESS
ARG NEXT_PUBLIC_BSC_PAYMENT_TOKEN_ADDRESS
ARG NEXT_PUBLIC_BSC_PROMO_TOKEN_ADDRESS
ARG NEXT_PUBLIC_METADATA_EXTERNAL_LINK
ARG PINATA_API_JWT
ARG PINATA_API_KEY
ARG PINATA_API_SECRET_KEY

ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_WC_PROJECT_ID=$NEXT_PUBLIC_WC_PROJECT_ID
ENV NEXT_PUBLIC_IS_TESTNET=$NEXT_PUBLIC_IS_TESTNET
ENV NEXT_PUBLIC_BSC_CHAIN_ID=$NEXT_PUBLIC_BSC_CHAIN_ID
ENV NEXT_PUBLIC_BSC_RPC_URL=$NEXT_PUBLIC_BSC_RPC_URL
ENV NEXT_PUBLIC_BSC_TICKET_FACTORY_ADDRESS=$NEXT_PUBLIC_BSC_TICKET_FACTORY_ADDRESS
ENV NEXT_PUBLIC_BSC_PROMO_FACTORY_ADDRESS=$NEXT_PUBLIC_BSC_PROMO_FACTORY_ADDRESS
ENV NEXT_PUBLIC_BSC_PAYMENT_TOKEN_ADDRESS=$NEXT_PUBLIC_BSC_PAYMENT_TOKEN_ADDRESS
ENV NEXT_PUBLIC_BSC_PROMO_TOKEN_ADDRESS=$NEXT_PUBLIC_BSC_PROMO_TOKEN_ADDRESS
ENV NEXT_PUBLIC_METADATA_EXTERNAL_LINK=$NEXT_PUBLIC_METADATA_EXTERNAL_LINK
ENV PINATA_API_JWT=$PINATA_API_JWT
ENV PINATA_API_KEY=$PINATA_API_KEY
ENV PINATA_API_SECRET_KEY=$PINATA_API_SECRET_KEY

WORKDIR /app

COPY . .

RUN npm install
RUN npm run gen:wagmi
RUN npm run gen:api
RUN npm run build

CMD ["npm", "run", "start"]
